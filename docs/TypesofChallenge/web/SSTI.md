# SSTI

## 一、漏洞成因

> **当用户的输入数据没有被合理的处理控制时，就有可能数据插入了程序段中变成了程序的一部分，从而改变了程序的执行逻辑**。

漏洞最早来自于2015 blackhat **Server-Side Template Injection: RCE for the modern webapp**。

## 二、CTF题型分类

### 1、盲打

#### （1）题型特征（识别方法）

1.Url?xxx=[用户输入]，同时用户输入的内容可以在页面上看到；

2.Http头server返回常见模板，如flask等

#### （2）常用解题套路

一般会实现收集好一些模板注入常规的payload，如{{ 7+7 }} or {7+7}，看页面上输出的内容是否为49。然后根据模板的种类选择payload。各个模板对应的paylaod如下

[pic](https://p5.ssl.qhimg.com/t01f4792c7d03dd49cc.png)

### 2、代码审计

#### （1）题型特征

主要见于各种CMS中，这类软件的特点是安装完成之后都会有多个类似风格的页面，这些页面通过一个固定的模板生成，需要审计模板代码获取SSTI漏洞。

#### （2）常用解题套路

CMS审计中，一般模板有一个单独的文件声明，在文件中有xxxheadxxx/xxxfootxxx之类的函数，这些函数代表头/尾模板的生成，看这些函数是否允许用户输入，如果允许，大概率存在模板注入。

## 三、例题（最好每类都有一个典型例题）

### 1、2018护网杯 -- easy_tornado

#### （1）题目

线上平台https://buuoj.cn

#### （2）解题思路（凝练、提炼、简短）

error页面显示了用户输入信息，可做SSTI。

#### （3）wp（可以是自己的也可以是链接）

https://www.cnblogs.com/xhds/p/12285121.html

### 2、2018qwb线下赛

#### （1）题目

cscms 4.1.75, 互联网可下。

#### （2）解题思路（凝练、提炼、简短）

{cscmsphp}{/cscmsphp}标签中内容未经验证直接给eval函数处理。

#### （3）wp（可以是自己的也可以是链接）

[2019强网杯线下web题解](https://mochazz.github.io/2019/06/19/2019强网杯线下Web题解/#cscms)

## 四、备注

1、是否可以程序化识别？是否可以通过查询题型特征数据库方式人工识别？

盲打的可以，把上面图的所有内容写一个爆破就可以验证是否存在。工具名字Tplmap

审计的话得具体情况具体分析。



2、是否可以形成通用EXP？

盲打可以，审计不行

## 五、Reference

1.[SSTI/沙盒逃逸详细总结](https://www.anquanke.com/post/id/188172)

2.[一篇文章带你理解漏洞之SSTI漏洞](https://www.k0rz3n.com/2018/11/12/一篇文章带你理解漏洞之SSTI漏洞/)